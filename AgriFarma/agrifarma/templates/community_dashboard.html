{% extends 'layouts/base.html' %}
{% from 'includes/page_header.html' import page_header %}

{% block title %}AgriFarma - Modern Agriculture Platform{% endblock %}
{% block breadcrumb %}{% endblock %}

{% set page_header_hide = true %}

{% block content %}

<!-- Modern Hero Section -->
<section class="af-hero-modern" style="background-image: url('{{ url_for('static', filename='img/backgrounds/home_bg.jpg') }}'); background-size: cover; background-position: center; background-attachment: fixed;">
  <div class="af-hero-bg" aria-hidden="true">
    <div class="gradient-layer"></div>
    <div class="texture-layer"></div>
    <div class="shapes">
      <span class="shape s1"></span>
      <span class="shape s2"></span>
      <span class="shape s3"></span>
      <span class="shape s4"></span>
    </div>
  </div>
  <div class="af-hero-inner container">
    <div class="af-hero-content">
      <h1 class="af-hero-title"><span>Grow Smarter</span> with AgriFarma</h1>
      <p class="af-hero-subtitle">Knowledge, community, experts & marketplace — everything to accelerate modern sustainable farming.</p>
      <div class="af-hero-cta">
        <a href="{{ url_for('forum.index') }}" class="af-btn af-btn-primary af-btn-lg"><i class="bi bi-chat-dots me-1"></i>Join the Community</a>
        <a href="{{ url_for('blog.list_posts') }}" class="af-btn af-btn-outline af-btn-lg"><i class="bi bi-journal-text me-1"></i>Explore Insights</a>
      </div>
      <div class="af-hero-stats">
        <div class="stat"><span class="number">{{ forum_count or '1.2k' }}+</span><span class="label">Discussions</span></div>
        <div class="stat"><span class="number">{{ blog_count or '480' }}+</span><span class="label">Articles</span></div>
        <div class="stat"><span class="number">{{ consultant_count or '95' }}+</span><span class="label">Consultants</span></div>
        <div class="stat"><span class="number">{{ product_count or '320' }}+</span><span class="label">Products</span></div>
      </div>
    </div>
    <div class="af-hero-media">
      <div class="af-hero-card prime">
        <div class="icon"><i class="bi bi-diagram-3"></i></div>
        <h3>Knowledge Graph</h3>
        <p>Curated, structured agricultural intelligence that evolves with the community.</p>
      </div>
      <div class="af-hero-card stack">
        <div class="mini-cards">
          <div class="mini-card"><i class="bi bi-seedling"></i><span>Soil</span></div>
          <div class="mini-card"><i class="bi bi-cloud-sun"></i><span>Weather</span></div>
          <div class="mini-card"><i class="bi bi-bug"></i><span>Pests</span></div>
          <div class="mini-card"><i class="bi bi-recycle"></i><span>Sustain</span></div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Feature Grid -->
<section class="af-feature-grid container">
  <div class="row g-4">
    <div class="col-md-6 col-lg-4">
      <div class="af-feature-item">
        <div class="fi-icon"><i class="bi bi-chat-dots"></i></div>
        <h3>Community Forum</h3>
        <p>Share experiences, solve problems, and learn from progressive growers.</p>
        <a href="{{ url_for('forum.index') }}" class="af-feature-link">Explore Forum <i class="bi bi-arrow-right"></i></a>
      </div>
    </div>
    <div class="col-md-6 col-lg-4">
      <div class="af-feature-item">
        <div class="fi-icon"><i class="bi bi-journal-text"></i></div>
        <h3>Knowledge Base</h3>
        <p>Structured articles, playbooks and real-world case studies.</p>
        <a href="{{ url_for('blog.list_posts') }}" class="af-feature-link">Read Articles <i class="bi bi-arrow-right"></i></a>
      </div>
    </div>
    <div class="col-md-6 col-lg-4">
      <div class="af-feature-item">
        <div class="fi-icon"><i class="bi bi-people"></i></div>
        <h3>Consultancy Access</h3>
        <p>Connect with specialists for agronomy, finance & sustainability.</p>
        <a href="{{ url_for('consultancy.consultants') }}" class="af-feature-link">Find Experts <i class="bi bi-arrow-right"></i></a>
      </div>
    </div>
    <div class="col-md-6 col-lg-4">
      <div class="af-feature-item">
        <div class="fi-icon"><i class="bi bi-basket"></i></div>
        <h3>Agri Marketplace</h3>
        <p>Vetted supplies & tools aligned with modern cultivation standards.</p>
        <a href="{{ url_for('shop.shop_list') }}" class="af-feature-link">Browse Products <i class="bi bi-arrow-right"></i></a>
      </div>
    </div>
    <div class="col-md-6 col-lg-4">
      <div class="af-feature-item">
        <div class="fi-icon"><i class="bi bi-shield-check"></i></div>
        <h3>Trust & Moderation</h3>
        <p>Quality-first ecosystem with guided curation & anti-spam controls.</p>
        <a href="{{ url_for('main.about') }}" class="af-feature-link">Learn More <i class="bi bi-arrow-right"></i></a>
      </div>
    </div>
    <div class="col-md-6 col-lg-4">
      <div class="af-feature-item">
        <div class="fi-icon"><i class="bi bi-cpu"></i></div>
        <h3>Data & Insights</h3>
        <p>Future-ready architecture for agronomic analytics & automation.</p>
        <a href="{{ url_for('main.about') }}" class="af-feature-link">Learn More <i class="bi bi-arrow-right"></i></a>
      </div>
    </div>
  </div>
</section>

<!-- Quick Stats Chips -->
<section class="container py-3">
  <div class="af-stat-chips d-flex flex-wrap gap-3">
    <div class="af-stat-chip">
      <span class="icon"><i class="bi bi-chat-dots"></i></span>
      <div>
        <span class="value">{{ forum_count or 0 }}</span>
        <span class="label">Discussions</span>
      </div>
    </div>
    <div class="af-stat-chip">
      <span class="icon"><i class="bi bi-journal-text"></i></span>
      <div>
        <span class="value">{{ blog_count or 0 }}</span>
        <span class="label">Articles</span>
      </div>
    </div>
    <div class="af-stat-chip">
      <span class="icon"><i class="bi bi-people"></i></span>
      <div>
        <span class="value">{{ consultant_count or 0 }}</span>
        <span class="label">Consultants</span>
      </div>
    </div>
    <div class="af-stat-chip">
      <span class="icon"><i class="bi bi-basket"></i></span>
      <div>
        <span class="value">{{ product_count or 0 }}</span>
        <span class="label">Products</span>
      </div>
    </div>
  </div>
  <hr class="my-4 hr-light"/>
</section>

<!-- Latest Discussions -->
<section class="container py-2">
  <div class="af-section-head d-flex align-items-end justify-content-between mb-3">
    <h2 class="m-0">Latest Discussions</h2>
    <a class="af-feature-link" href="{{ url_for('forum.index') }}">View Forum <i class="bi bi-arrow-right"></i></a>
  </div>
  {% if recent_threads %}
  <div class="row g-4">
    {% for th in recent_threads[:4] %}
    <div class="col-sm-6 col-lg-3">
      <div class="card h-100 shadow-soft">
        <div class="card-body d-flex flex-column">
          <a class="stretched-link fw-semibold mb-2 text-decoration-none" href="{{ url_for('forum.thread_view', thread_id=th.id) }}">{{ th.title }}</a>
          <div class="text-muted small mt-auto">
            <i class="bi bi-person"></i>
            {{ th.author.email.split('@')[0] if th.author else 'Member' }} •
            <i class="bi bi-clock"></i>
            {{ th.created_at.strftime('%b %d') if th.created_at else '' }}
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
    <div class="af-empty-state text-center">
      <i class="bi bi-chat-dots af-empty-icon"></i>
      <h3>No threads yet</h3>
      <p class="text-muted">Be the first to start a discussion.</p>
      <a href="{{ url_for('forum.new_thread') }}" class="af-btn af-btn-primary af-btn-sm"><i class="bi bi-plus"></i> New Thread</a>
    </div>
  {% endif %}
</section>

<!-- Trending Articles -->
<section class="container py-4">
  <div class="af-section-head d-flex align-items-end justify-content-between mb-3">
    <h2 class="m-0">Trending Articles</h2>
    <a class="af-feature-link" href="{{ url_for('blog.list_posts') }}">All Articles <i class="bi bi-arrow-right"></i></a>
  </div>
  {% if recent_posts %}
  <div class="row g-4">
    {% for p in recent_posts[:4] %}
    <div class="col-sm-6 col-lg-6">
      <a href="{{ url_for('blog.detail', post_id=p.id) }}" class="kb-card text-decoration-none h-100">
        <div class="kb-thumb" style="background-image:url('{{ p.cover_url if p.cover_url else url_for('static', filename='img/placeholders/article.jpg') }}')"></div>
        <div class="kb-body">
          <h3 class="kb-title">{{ p.title }}</h3>
          <div class="kb-meta">
            <i class="bi bi-person"></i> {{ p.author.email.split('@')[0] if p.author else 'Author' }} •
            <i class="bi bi-clock"></i> {{ p.created_at.strftime('%b %d') if p.created_at else '' }}
          </div>
          {% if p.summary %}<p class="kb-excerpt">{{ p.summary }}</p>{% endif %}
        </div>
      </a>
    </div>
    {% endfor %}
  </div>
  {% else %}
    <div class="af-empty-state text-center">
      <i class="bi bi-journal-text af-empty-icon"></i>
      <h3>No articles yet</h3>
      <p class="text-muted">New content will appear here.</p>
    </div>
  {% endif %}
</section>

<!-- Featured Consultants -->
<section class="container py-4">
  <div class="af-section-head d-flex align-items-end justify-content-between mb-3">
    <h2 class="m-0">Featured Consultants</h2>
    <a class="af-feature-link" href="{{ url_for('consultancy.consultants') }}">All Experts <i class="bi bi-arrow-right"></i></a>
  </div>
  {% if consultants %}
  <div class="row g-4">
    {% for c in consultants[:4] %}
    <div class="col-sm-6 col-lg-3">
      <div class="card h-100 shadow-soft">
        <div class="card-body d-flex flex-column">
          <div class="d-flex align-items-center gap-2 mb-2">
            <div class="af-avatar af-avatar-40"><span class="af-avatar-initials">{{ (c.name or 'AG')[:2] }}</span></div>
            <div>
              <div class="fw-semibold">{{ c.name or 'Consultant' }}</div>
              <small class="text-muted">{{ c.category or 'Agronomy' }}</small>
            </div>
          </div>
          <p class="text-muted small mb-3">{{ (c.bio or 'Experienced specialist in modern farming practices.')[:96] }}{% if c.bio and c.bio|length > 96 %}…{% endif %}</p>
          <div class="mt-auto">
            <a class="af-product-cta" href="{{ url_for('consultancy.consultant_profile', consultant_id=c.id) }}">View Profile <i class="bi bi-arrow-right"></i></a>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
    <div class="af-empty-state text-center">
      <i class="bi bi-people af-empty-icon"></i>
      <h3>No consultants yet</h3>
      <p class="text-muted">Approved experts will appear here.</p>
    </div>
  {% endif %}
</section>

<!-- Popular Products -->
<section class="container py-4">
  <div class="af-section-head d-flex align-items-end justify-content-between mb-3">
    <h2 class="m-0">Popular Products</h2>
    <a class="af-feature-link" href="{{ url_for('shop.shop_list') }}">Go to Shop <i class="bi bi-arrow-right"></i></a>
  </div>
  {% if products %}
  <div class="row g-4 row-cols-1 row-cols-sm-2 row-cols-lg-4">
    {% for pr in products[:4] %}
    <div class="col">
      <a class="af-product-card" href="{{ url_for('shop.product_detail', product_id=pr.id) }}">
        <div class="af-product-img" style="background-image:url('{{ url_for('static', filename='uploads/products/' + (pr.images.split(',')[0] if pr.images else 'product_1.jpg')) }}')"></div>
        <div class="af-product-body">
          <div class="af-product-title">{{ pr.name }}</div>
          <div class="af-product-category"><i class="bi bi-tag"></i>{{ pr.category or 'General' }}</div>
          <div class="af-product-footer">
            <div class="af-product-price">₹{{ '%.0f'|format(pr.price or 0) }}</div>
            <div class="af-product-cta">Details <i class="bi bi-arrow-right"></i></div>
          </div>
        </div>
      </a>
    </div>
    {% endfor %}
  </div>
  {% else %}
    <div class="af-empty-state text-center">
      <i class="bi bi-basket af-empty-icon"></i>
      <h3>No products yet</h3>
      <p class="text-muted">Active items will appear here.</p>
    </div>
  {% endif %}
</section>

<!-- Secondary CTA Strip -->
<section class="af-cta-strip">
  <div class="container">
    <div class="af-cta-strip-inner">
      <h3>Ready to transform your agriculture journey?</h3>
      <div class="actions">
        <a href="{{ url_for('auth.register') }}" class="af-btn af-btn-primary"><i class="bi bi-person-plus me-1"></i>Create Account</a>
        <a href="{{ url_for('main.contact') }}" class="af-btn af-btn-outline"><i class="bi bi-envelope me-1"></i>Contact Us</a>
      </div>
    </div>
  </div>
</section>

{% endblock %}
