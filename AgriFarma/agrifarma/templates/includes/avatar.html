{% macro avatar(user, size=48) -%}
{#
  Renders a circular avatar. If user.profile.profile_picture exists, show it.
  Otherwise render a styled initials block using the user's name or email.
  Usage: {% from 'includes/avatar.html' import avatar %} then {{ avatar(user, 48) }}
#}
{%- set profile = user.profile if user.profile is defined else None -%}
{%- set name = (profile.name if profile and profile.name else (user.email.split('@')[0] if user and user.email else 'U')) -%}
{%- set initial = name[:1].upper() -%}
{%- if profile and profile.profile_picture -%}
  <img src="{{ profile.profile_picture }}" width="{{ size }}" height="{{ size }}" class="rounded-circle af-avatar-img" alt="{{ name }}">
{%- else -%}
  <div class="af-avatar af-avatar-initials" style="width:{{ size }}px;height:{{ size }}px;font-size:{{ (size//2)|int }}px;">{{ initial }}</div>
{%- endif -%}
{%- endmacro %}
